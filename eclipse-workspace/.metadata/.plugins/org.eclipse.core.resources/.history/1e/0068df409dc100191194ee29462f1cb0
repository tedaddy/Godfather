// Instruction
/*


DBmanager db = new DBmanager();  -- Create object of DBmanager
db.addSource(databaseName, JSONObject) -- Add new model to db
db.getSource(databaseName, number of variant) -- Get variant model from db
db.getCountOfVariants(databaseName) -- Get count of all variants in some db


 */



import org.json.JSONObject;
import org.json.JSONArray;
import org.json.JSONTokener;

import java.io.*;
import java.io.FileWriter;

import javax.swing.*;
import java.awt.event.*;



import java.io.FileInputStream;
import java.io.FileNotFoundException;

import java.util.Scanner;


public class DBmanager {
	
	private String resourceName = "src/databases/";
	
	
    public JSONObject getSource(String databaseName, int number) {
    	String database = resourceName + databaseName + ".json";
    	try {
    		FileInputStream fstream = new FileInputStream(database);
            BufferedReader br = new BufferedReader(new InputStreamReader(fstream));
            JSONTokener tokener = new JSONTokener(br);
            JSONArray all_variants = new JSONObject(tokener).getJSONArray("items");
            JSONObject needed_var = all_variants.getJSONObject(number-1);
            return needed_var;
    	}catch(Exception ex) {
    		System.out.println(ex);
    		return null;
    	}
    
    }
    
    public int getCountOfVariants(String databaseName) {
    	String database = resourceName + databaseName + ".json";
    	int count;
    	try {
    	    FileInputStream fstream = new FileInputStream(database);
    	    BufferedReader br = new BufferedReader(new InputStreamReader(fstream));
    	    JSONTokener tokener = new JSONTokener(br);
    	    JSONArray all_variants = new JSONObject(tokener).getJSONArray("items");
    	    count = all_variants.length();
    	    return count;
    	}catch(Exception ex) {
    	    System.out.println(ex);
    	    return 0;
    	}
    }
    
    public void addSource(String databaseName, JSONObject jObject) {
    	String database = resourceName + databaseName + ".json";
    	try {
    	    FileInputStream fstream = new FileInputStream(database);
            BufferedReader br = new BufferedReader(new InputStreamReader(fstream));
            JSONTokener tokener = new JSONTokener(br);
            JSONArray ja = new JSONObject(tokener).getJSONArray("items");
            ja.put(jObject);
            JSONObject jo = new JSONObject();
            jo.put("items", ja);
		
            try (FileWriter file = new FileWriter(database)) {
	        	 
            	file.write(jo.toString());
            	file.flush();
	 
            } catch (IOException e) {
            	e.printStackTrace();
            	System.out.println(e);
            }
    	}catch(Exception ex) {}
    }
    
}
